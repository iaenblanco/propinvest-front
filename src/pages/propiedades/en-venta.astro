---
// src/pages/propiedades/en-venta.astro
import Layout from '../../layouts/Layout.astro';
import PropertyTypeFilter from '../../components/PropertyTypeFilter.astro';

const API_URL = 'https://truthful-rhythm-e8bcafa766.strapiapp.com/api';
// LA ÚNICA DIFERENCIA: Añadimos un filtro para Objetivo=Venta
const response = await fetch(`${API_URL}/propiedads?populate=*&filters[Publicado][$eq]=true&filters[Objetivo][$eq]=Venta`);
const { data: propiedades } = await response.json();

// CORREGIDO: Los datos vienen directamente, no en prop.attributes
const propiedadesValidas = Array.isArray(propiedades) ? propiedades.filter(prop => prop && prop.Objetivo === 'Venta' && prop.Publicado === true) : [];

// ORDENAR POR REGIÓN DE A-Z
const propiedadesOrdenadas = propiedadesValidas.sort((a, b) => {
  const regionA = (a.Region || '').toLowerCase();
  const regionB = (b.Region || '').toLowerCase();
  return regionA.localeCompare(regionB, 'es');
});
---
<Layout
  title="Propiedades en Venta | PropInvest"
  description="Explora nuestra selección de propiedades de lujo en venta."
>
  <main>
    <section class="container" style="margin-top:3rem;">
      <div class="section-title">Propiedades en Venta</div>
      <div class="section-subtitle"></div>
      
      <PropertyTypeFilter properties={propiedadesOrdenadas} />
    </section>
  </main>
</Layout>