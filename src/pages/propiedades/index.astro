---
import Layout from '../../layouts/Layout.astro';
import PropertyTypeFilter from '../../components/PropertyTypeFilter.astro';

const API_URL = 'https://truthful-rhythm-e8bcafa766.strapiapp.com/api';
const response = await fetch(`${API_URL}/propiedads?populate=*&filters[Publicado][$eq]=true`);
const { data: propiedades } = await response.json();

// CORREGIDO: Los datos vienen directamente, no en prop.attributes
const propiedadesValidas = Array.isArray(propiedades) ? propiedades.filter(prop => prop && prop.Publicado === true) : [];

// ORDENAR POR REGIÃ“N DE A-Z
const propiedadesOrdenadas = propiedadesValidas.sort((a, b) => {
  const regionA = (a.Region || '').toLowerCase();
  const regionB = (b.Region || '').toLowerCase();
  return regionA.localeCompare(regionB, 'es');
});
---
<Layout
  title="Todas las Propiedades | PropInvest"
>
  <main>
    <section class="container" style="margin-top:3rem;">
      <div class="section-title">Todas las Propiedades</div>
      
      <PropertyTypeFilter properties={propiedadesOrdenadas} />
    </section>
  </main>
</Layout>