---
// src/pages/propiedades/en-arriendo.astro
import Layout from '../../layouts/Layout.astro';
import PropertyTypeFilter from '../../components/PropertyTypeFilter.astro';

const API_URL = 'https://truthful-rhythm-e8bcafa766.strapiapp.com/api';
const response = await fetch(`${API_URL}/propiedads?populate=*&filters[Publicado][$eq]=true&filters[Objetivo][$eq]=Arriendo`);

// LÍNEA AÑADIDA: Extraemos los datos y los guardamos en la variable `propiedades`.
const { data: propiedades } = await response.json();

// CORREGIDO: Los datos vienen directamente, no en prop.attributes
const propiedadesValidas = Array.isArray(propiedades) ? propiedades.filter(prop => prop && prop.Objetivo === 'Arriendo' && prop.Publicado === true) : [];

// ORDENAR POR REGIÓN DE A-Z
const propiedadesOrdenadas = propiedadesValidas.sort((a, b) => {
  const regionA = (a.Region || '').toLowerCase();
  const regionB = (b.Region || '').toLowerCase();
  return regionA.localeCompare(regionB, 'es');
});
---
<Layout
  title="Propiedades en Arriendo | PropInvest"
  description="Explora nuestra selección de propiedades de lujo en arriendo."
>
  <main>
    <section class="container" style="margin-top:3rem;">
      <div class="section-title">Propiedades en Arriendo</div>
      <div class="section-subtitle"></div>
      
      <PropertyTypeFilter properties={propiedadesOrdenadas} />
    </section>
  </main>
</Layout>