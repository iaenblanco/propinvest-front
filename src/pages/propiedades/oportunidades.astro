---
// src/pages/propiedades/oportunidades.astro
import Layout from '../../layouts/Layout.astro';
import PropertyTypeFilter from '../../components/PropertyTypeFilter.astro';

const API_URL = 'https://truthful-rhythm-e8bcafa766.strapiapp.com/api';
// CORREGIDO: El campo correcto es "Oportunidades" (plural) no "Oportunidad"
const response = await fetch(`${API_URL}/propiedads?populate=*&filters[Publicado][$eq]=true&filters[Oportunidades][$eq]=true`);

// Extraemos los datos y los guardamos en la variable `propiedades`.
const { data: propiedades } = await response.json();

// CORREGIDO: Los datos vienen directamente, no en prop.attributes
const propiedadesValidas = Array.isArray(propiedades) ? propiedades.filter(prop => prop && prop.Oportunidades === true) : [];
---
<Layout
  title="Oportunidades Inmobiliarias | PropInvest"
  description="Descubre propiedades con gran potencial de inversión y revalorización."
>
  <main>
    <section class="container" style="margin-top:3rem;">
      <div class="section-title">Oportunidades Inmobiliarias</div>
      <div class="section-subtitle"></div>
      
      <PropertyTypeFilter properties={propiedadesValidas} />
    </section>
  </main>
</Layout>